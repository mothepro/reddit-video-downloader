<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta 
    http-equiv="X-UA-Compatible"
    content="IE=edge"
  >
  <meta 
    name="viewport"
    content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
  >
  <title>Bookmarklet</title>
  <link 
    rel="stylesheet"
    href="https://unpkg.com/@picocss/pico@latest/css/pico.classless.min.css"
  >
</head>

<body>
  <main class="container">
    <h1>Bookmarklet</h1>
    <article>
      <ol>
        <li>
          Drag <a role="button" bookmarklet href="javascript:(function(){%22use%20strict%22;function%20o(o,r=%22Assertion%20Error%22)%7Bif(!o)throw%20new%20Error(r)%7Dtry%7Bconst%7Bhostname:r,href:t%7D=location;o(r.endsWith(%22reddit.com%22),%22This%20bookmarklet%20only%20works%20on%20reddit%22);const%20e=new%20URL(t);e.hostname=%22redditdl.com%22,location.href=e.toString()%7Dcatch(r)%7Bo(r%20instanceof%20Error),alert(r.message)%7D})();">Bookmarklet</a> to your bookmarks
        </li>
      </ol>
    </article>
  </main>
  <footer>
    Made by Mo <span build-time="1675845561493">Wed Feb 08 2023 02:39:21 GMT-0600 (Central Standard Time)</span> with
    <a 
      href="https://github.com/mothepro/bookmarklet"
      target="_blank"
      rel="noopener noreferrer"
    >TypeScript</a>.
  </footer>
</body>

<script>
  // TODO use the `new Intl.RelativeTimeFormat(undefined, { style: 'narrow' })`
  function timeAgo(prevDate) {
    const diff = Date.now() - prevDate
    const minute = 60 * 1000
    const hour = minute * 60
    const day = hour * 24
    const month = day * 30
    const year = day * 365
    switch (true) {
      case diff < minute:
        const seconds = Math.round(diff / 1000)
        return `${seconds} second${seconds > 1 ? 's' : ''} ago`
      case diff < hour:
        return Math.round(diff / minute) + ' minutes ago'
      case diff < day:
        return Math.round(diff / hour) + ' hours ago'
      case diff < month:
        return Math.round(diff / day) + ' days ago'
      case diff < year:
        return Math.round(diff / month) + ' months ago'
      case diff > year:
        return Math.round(diff / year) + ' years ago'
      default:
        return ""
    }
  };

  const
    element = document.querySelector('[build-time]'),
    buildTime = element.getAttribute('build-time'),
    date = new Date(parseInt(buildTime))
  element.innerHTML = timeAgo(+date)
  element.title = date.toString()
</script>

</html>

