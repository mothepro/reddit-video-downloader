<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta
    http-equiv="X-UA-Compatible"
    content="IE=edge"
  >
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
  >
  <title>Bookmarklet</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/@picocss/pico@latest/css/pico.classless.min.css"
  >
</head>

<body>
  <main class="container">
    <h1>Bookmarklet</h1>
    <article>
      <ol>
        <li>
          Drag <a role="button" bookmarklet>Bookmarklet</a> to your bookmarks
        </li>
      </ol>
    </article>
  </main>
  <footer>
    Made by Mo <span build-time>a while back</span> with
    <a
      href="https://github.com/mothepro/bookmarklet"
      target="_blank"
      rel="noopener noreferrer"
    >TypeScript</a>.
  </footer>
</body>

<script>
  // TODO use the `new Intl.RelativeTimeFormat(undefined, { style: 'narrow' })`
  function timeAgo(prevDate) {
    const diff = Date.now() - prevDate
    const minute = 60 * 1000
    const hour = minute * 60
    const day = hour * 24
    const month = day * 30
    const year = day * 365
    switch (true) {
      case diff < minute:
        const seconds = Math.round(diff / 1000)
        return `${seconds} second${seconds > 1 ? 's' : ''} ago`
      case diff < hour:
        return Math.round(diff / minute) + ' minutes ago'
      case diff < day:
        return Math.round(diff / hour) + ' hours ago'
      case diff < month:
        return Math.round(diff / day) + ' days ago'
      case diff < year:
        return Math.round(diff / month) + ' months ago'
      case diff > year:
        return Math.round(diff / year) + ' years ago'
      default:
        return ""
    }
  };

  const
    element = document.querySelector('[build-time]'),
    buildTime = element.getAttribute('build-time'),
    date = new Date(parseInt(buildTime))
  element.innerHTML = timeAgo(+date)
  element.title = date.toString()
</script>

</html>
